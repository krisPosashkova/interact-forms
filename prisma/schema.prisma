generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model tags {
  id            Int             @id @default(autoincrement())
  name          String          @unique @db.VarChar(100)
  template_tags template_tags[]

  @@index([name], map: "idx_tags_name")
}

model template_tags {
  template_id Int
  tag_id      Int
  tags        tags      @relation(fields: [tag_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  templates   templates @relation(fields: [template_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@id([template_id, tag_id])
  @@index([template_id, tag_id], map: "idx_template_tags")
}

model templates {
  id            Int             @id @default(autoincrement())
  user_id       Int
  title         String          @db.VarChar(100)
  description   String?
  created_at    DateTime?       @default(now()) @db.Timestamp(6)
  updated_at    DateTime?       @default(now()) @db.Timestamp(6)
  is_public     Boolean?        @default(false)
  template_tags template_tags[]
  users         users           @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model users {
  id            Int         @id @default(autoincrement())
  username      String      @db.VarChar(50)
  email         String      @unique @db.VarChar(100)
  password_hash String?     @db.VarChar(255)
  role          user_role?  @default(user)
  created_at    DateTime?   @default(now()) @db.Timestamp(6)
  updated_at    DateTime?   @default(now()) @db.Timestamp(6)
  templates     templates[]
}

enum user_role {
  user
  admin
}
